
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flask-WebTest &mdash; Flask-WebTest 0.0.3 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Flask-WebTest 0.0.3 documentation" href="#" /> 
  </head>
  <body>
  
  
  <div class=indexwrapper>
  


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="flask-webtest">
<h1>Flask-WebTest<a class="headerlink" href="#flask-webtest" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#installation" id="id2">Installation</a></li>
<li><a class="reference internal" href="#example-of-usage" id="id3">Example of usage</a></li>
<li><a class="reference internal" href="#best-practices" id="id4">Best practices</a><ul>
<li><a class="reference internal" href="#using-flask-webtest-with-flask-sqlalchemy" id="id5">Using Flask-WebTest with Flask-SQLAlchemy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-documentation" id="id6">API Documentation</a><ul>
<li><a class="reference internal" href="#api-related-to-flask-sqlalchemy" id="id7">API related to Flask-SQLAlchemy</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Flask-WebTest provides a set of utilities to ease testing <a class="reference external" href="http://flask.pocoo.org/">Flask</a>
applications with <a class="reference external" href="http://webtest.readthedocs.org/en/">WebTest</a>.</p>
<ul class="simple">
<li><a class="reference internal" href="#flask.ext.webtest.TestApp" title="flask.ext.webtest.TestApp"><tt class="xref py py-class docutils literal"><span class="pre">TestApp</span></tt></a> extends <tt class="xref py py-class docutils literal"><span class="pre">webtest.TestApp</span></tt>&#8216;s response by adding fields that
provides access to the template contexts, session data and flashed messages.</li>
<li><a class="reference internal" href="#flask.ext.webtest.SessionScope" title="flask.ext.webtest.SessionScope"><tt class="xref py py-class docutils literal"><span class="pre">SessionScope</span></tt></a> and <a class="reference internal" href="#flask.ext.webtest.get_scopefunc" title="flask.ext.webtest.get_scopefunc"><tt class="xref py py-func docutils literal"><span class="pre">get_scopefunc()</span></tt></a> allow to manage SQLAlchemy session
scoping ―  it&#8217;s very useful for testing.</li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id2">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">flask-webtest</span></tt></p>
</div>
<div class="section" id="example-of-usage">
<h2><a class="toc-backref" href="#id3">Example of usage</a><a class="headerlink" href="#example-of-usage" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">flask.ext.webtest</span> <span class="kn">import</span> <span class="n">TestApp</span>
<span class="kn">from</span> <span class="nn">main</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">db</span>

<span class="k">class</span> <span class="nc">ExampleTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">TestApp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">use_session_scopes</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c"># Note: `self.app.wsgi_app` would be great too</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="c"># Assert there was no messages flushed:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">flashes</span><span class="p">)</span>
        <span class="c"># Access and check any variable from template context...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">],</span> <span class="s">&#39;Hello!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="s">&#39;template.html&#39;</span><span class="p">)</span>
        <span class="c"># ...and from session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;user_id&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="best-practices">
<h2><a class="toc-backref" href="#id4">Best practices</a><a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-flask-webtest-with-flask-sqlalchemy">
<h3><a class="toc-backref" href="#id5">Using Flask-WebTest with Flask-SQLAlchemy</a><a class="headerlink" href="#using-flask-webtest-with-flask-sqlalchemy" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s suppose there is a simple application consisting of two views (and <cite>User</cite> model which
is omitted for brevity):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/user/&lt;int:id&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">greet</span><span class="p">()</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/user/&lt;int:id&gt;/preview/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">greeting</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
    <span class="c"># Expunge `user` from the session so that we can</span>
    <span class="c"># call `db.session.commit` later and do not change</span>
    <span class="c"># user data in table</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">expunge</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">greet</span><span class="p">()</span>
</pre></div>
</div>
<p>How can one test it using WebTest?
An approach that comes to mind first may look as follows:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">TestApp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">drop_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Anton&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/user/</span><span class="si">%i</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;Hello, Anton!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Everything looks good, but sometimes strange (at first sight) things happen:</p>
<ul>
<li><p class="first">Uncommitted changes happen to be used to build the response:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Petr&#39;</span>
<span class="c"># Note: we did not commit the change to `user`!</span>
<span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/user/</span><span class="si">%i</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;Hello, Anton!&#39;</span><span class="p">)</span>
<span class="c"># AssertionError: &#39;Hello, Petr!&#39; != &#39;Hello, Anton!&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">Model disappear from the session after request:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/user/</span><span class="si">%i</span><span class="s">/preview/&#39;</span> <span class="o">%</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
    <span class="s">&#39;greeting&#39;</span><span class="p">:</span> <span class="s">&#39;Hi, </span><span class="si">%s</span><span class="s">.&#39;</span><span class="p">,</span>
<span class="p">})</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;Hi, Anton.&#39;</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c"># InvalidRequestError: Instance &#39;&lt;User at 0xa8c0e8c&gt;&#39; is</span>
<span class="c"># not persistent within this session</span>
</pre></div>
</div>
</li>
<li><p class="first">And so on.</p>
</li>
</ul>
<p>These examples may seem a bit contrived, but they will likely arise in your project as it
uses the ORM more extensively.</p>
<p>Why do they appear? Because we use the same SQLAlchemy session in our test and application code.</p>
<p>Any time you call <tt class="docutils literal"><span class="pre">db.session</span></tt>, it passes the call to the session
bound to the current scope (which is defined by <tt class="docutils literal"><span class="pre">scopefunc</span></tt>).
By default, Flask-SQLAlchemy defines <tt class="docutils literal"><span class="pre">scopefunc</span></tt> to return current thread&#8217;s identity.</p>
<p>In production, normally:</p>
<ol class="arabic simple">
<li>Only one request being handled at a time within each thread;</li>
<li>The session being opened the first time <tt class="docutils literal"><span class="pre">db.session</span></tt> is called;</li>
<li>Flask-SQLAlchemy closes the session after request (more exactly,
on application teardown).</li>
</ol>
<p>Providing that, the application uses a new separate session during each request.
The session is opened at the start and closed at the end of the request.</p>
<p>In the current tests&#8217; implementation:</p>
<ol class="arabic simple">
<li>Every request being handled in the same thread, hence using the same SQLAlchemy session;</li>
<li>The session being opened the first time <tt class="docutils literal"><span class="pre">db.session</span></tt> is called, and it happens
when the test loads fixtures;</li>
<li>Flask-SQLAlchemy closes the session on application teardown. It happens
only in <tt class="docutils literal"><span class="pre">tearDown</span></tt> method ― when the last context leaves the
application contexts&#8217; stack.</li>
</ol>
<p>So, the situation is very different: the same SQLAlchemy session is being used
to handle all the requests made during test. This is a major difference from
how things work in production and it would be great to eliminate it.</p>
<p>Flask-WebTest provides means to easily manage SQLAlchemy scopes:
<tt class="docutils literal"><span class="pre">SQLAlchemyScope</span></tt> that you can enter and exit and custom <tt class="docutils literal"><span class="pre">scopefunc</span></tt>
that has to be used during testing.</p>
<p>How to make use of them:</p>
<ol class="arabic">
<li><p class="first">Replace default <tt class="docutils literal"><span class="pre">scopefunc</span></tt> with <tt class="docutils literal"><span class="pre">SQLAlchemyScope</span></tt>-aware <tt class="docutils literal"><span class="pre">scopefunc</span></tt> from Flask-WebTest:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask.ext.webtest</span> <span class="kn">import</span> <span class="n">scopefunc</span>

<span class="k">def</span> <span class="nf">make_db</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">session_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">testing</span><span class="p">:</span>
        <span class="n">session_options</span><span class="p">[</span><span class="s">&#39;scopefunc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scopefunc</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">session_options</span><span class="o">=</span><span class="n">session_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">make_db</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Whenever you want a piece of code to use a new SQLAlchemy session, execute it within a scope:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Anton&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">print</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span>  <span class="c"># True</span>

<span class="k">with</span> <span class="n">SessionScope</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="c"># Brand new session!</span>
    <span class="k">print</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span>  <span class="c"># False</span>
</pre></div>
</div>
<p>or</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">scope</span> <span class="o">=</span> <span class="n">SessionScope</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">scope</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">scope</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
<p>It makes sense to use a fresh SQLAlchemyScope for every request.
<a class="reference internal" href="#flask.ext.webtest.TestApp" title="flask.ext.webtest.TestApp"><tt class="xref py py-class docutils literal"><span class="pre">TestApp</span></tt></a> will do it for you if you pass <cite>db</cite> to it&#8217;s
constructor and specify <cite>use_session_scopes</cite>.</p>
<p>If your project uses Celery (or other task queue) and
performs tasks synchronously during tests ― it&#8217;s a great idea
to run them within separate scopes too.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Be aware that models is bound to the session and
in general you can&#8217;t use object which session was removed:</p>
<div class="code python last highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">SessionScope</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">john</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>
    <span class="c"># Note: commit expires all models (SQLAlchemy has</span>
    <span class="c"># expire_on_commit=True by default)...</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">print</span> <span class="n">john</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span>  <span class="c"># False</span>

<span class="c"># Any call to the expired model requires database hit, so</span>
<span class="c"># `print john.name` would cause the following error:</span>
<span class="c">#</span>
<span class="c"># DetachedInstanceError: Instance &lt;User at 0x95c756c&gt;</span>
<span class="c"># is not bound to a Session; attribute refresh</span>
<span class="c"># operation cannot proceed</span>
<span class="c">#</span>
<span class="c"># It would happen because `john`&#39;s session no longer exists.</span>
<span class="c"># To continue working with detached object, we need to</span>
<span class="c"># reconcile it with the current session:</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>

<span class="k">print</span> <span class="n">john</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span>  <span class="c"># True</span>
<span class="k">print</span> <span class="n">john</span><span class="o">.</span><span class="n">name</span>  <span class="c"># John</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="api-documentation">
<h2><a class="toc-backref" href="#id6">API Documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<p>This documentation is automatically generated from Flask-WebTest&#8217;s source code.</p>
<dl class="class">
<dt id="flask.ext.webtest.TestApp">
<em class="property">class </em><tt class="descclassname">flask.ext.webtest.</tt><tt class="descname">TestApp</tt><big>(</big><em>db=None</em>, <em>use_session_scopes=False</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/flask/ext/webtest.html#TestApp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.webtest.TestApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends <tt class="xref py py-class docutils literal"><span class="pre">webtest.TestApp</span></tt> by adding few fields to responses:</p>
<dl class="attribute">
<dt id="flask.ext.webtest.TestApp.templates">
<tt class="descname">templates</tt><a class="headerlink" href="#flask.ext.webtest.TestApp.templates" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary containing information about what templates were used to
build the response and what their contexts were.
The keys are template names and the values are template contexts.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.ext.webtest.TestApp.flashes">
<tt class="descname">flashes</tt><a class="headerlink" href="#flask.ext.webtest.TestApp.flashes" title="Permalink to this definition">¶</a></dt>
<dd><p>List of tuples (category, message) containing messages that were
flashed during request.</p>
<p>Note: Fully supported only starting with Flask 0.10. If you use
previous version, <cite>flashes</cite> will contain only those messages that
were consumed by <a class="reference external" href="http://flask.pocoo.org/docs/api/#flask.get_flashed_messages" title="(in Flask v0.10)"><tt class="xref py py-func docutils literal"><span class="pre">flask.get_flashed_messages()</span></tt></a> template calls.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.ext.webtest.TestApp.session">
<tt class="descname">session</tt><a class="headerlink" href="#flask.ext.webtest.TestApp.session" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary containing session data.</p>
</dd></dl>

<p>If exactly one template was used to render the response, it&#8217;s name and context
can be accessed using <cite>response.template</cite> and <cite>response.context</cite> properties.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>db</strong> &#8211; <tt class="xref py py-class docutils literal"><span class="pre">flask.ext.sqlalchemy.SQLAlchemy</span></tt> instance</li>
<li><strong>use_session_scopes</strong> &#8211; if specified, application performs each request
within it&#8217;s own separate session scope</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="api-related-to-flask-sqlalchemy">
<h3><a class="toc-backref" href="#id7">API related to Flask-SQLAlchemy</a><a class="headerlink" href="#api-related-to-flask-sqlalchemy" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="flask.ext.webtest.get_scopefunc">
<tt class="descclassname">flask.ext.webtest.</tt><tt class="descname">get_scopefunc</tt><big>(</big><em>original_scopefunc=None</em><big>)</big><a class="reference internal" href="_modules/flask/ext/webtest.html#get_scopefunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.webtest.get_scopefunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <tt class="xref py py-func docutils literal"><span class="pre">SessionScope()</span></tt>-aware <cite>scopefunc</cite> that has to be used
during testing.</p>
</dd></dl>

<dl class="class">
<dt id="flask.ext.webtest.SessionScope">
<em class="property">class </em><tt class="descclassname">flask.ext.webtest.</tt><tt class="descname">SessionScope</tt><big>(</big><em>db</em><big>)</big><a class="reference internal" href="_modules/flask/ext/webtest.html#SessionScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.webtest.SessionScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Session scope, being pushed, changes the value of
<tt class="xref py py-func docutils literal"><span class="pre">scopefunc()</span></tt> and, as a result, calls to <cite>db.session</cite>
are proxied to the new underlying session.
When popped, removes the current session and swap the value of
<tt class="xref py py-func docutils literal"><span class="pre">scopefunc()</span></tt> to the one that was before.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>db</strong> &#8211; <tt class="xref py py-class docutils literal"><span class="pre">flask.ext.sqlalchemy.SQLAlchemy</span></tt> instance</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="flask.ext.webtest.SessionScope.push">
<tt class="descname">push</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/webtest.html#SessionScope.push"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.webtest.SessionScope.push" title="Permalink to this definition">¶</a></dt>
<dd><p>Pushes the session scope.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ext.webtest.SessionScope.pop">
<tt class="descname">pop</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/webtest.html#SessionScope.pop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.webtest.SessionScope.pop" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the current session and pops the session scope.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <a href="http://github.com/aromanovich/flask-webtest"><img style="position: fixed; top: 0; right: 0; border: 0;"
    src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  

  
  </div>
  

  </body>
</html>